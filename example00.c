


#include "tsconf.h"

/*
.fill_screen	
	defb 0x1a,0
	defb 0x1b,0
	defb 0x1c,GFX_Vid_page
	defb 0x1d,0
	defb 0x1e,0
	defb 0x1f,GFX_Vid_page
	defb 0x28,200
	defb 0x26,0xff
	defb 0x27,%00000100    // DMA_FILL
	defb 0xff
*/

/*#asm
.sprites
	defb 64, SP_SIZE64 | 0 | SP_ACT, 64, SP_SIZE64, 0, (3<<4) | 1 //("or 1" sets the tile number to +=256)
	defb 64, SP_SIZE64 | 0 | SP_ACT, 128, SP_SIZE64, 8, (3<<4) | 1
	defb 64, SP_SIZE64 | 0 | SP_ACT, 192, SP_SIZE64, 16, (3<<4) | 1
	defb 128, SP_SIZE64 | SP_LEAP | SP_ACT, 64, SP_SIZE64, 24, (3<<4) | 1
	defb 128, SP_SIZE64 | SP_LEAP | SP_ACT, 128, SP_SIZE64, 32, (3<<4) | 1
	defb 128, SP_SIZE64 | SP_LEAP | SP_ACT, 192, SP_SIZE64, 40, (3<<4) | 1
.sprites_end
*/



uint8_t GFX_Page = 0x22; //Image at C000 page 0x22
uint8_t GFX_Video_Page = 0xA0; //Page used for gfx display

uint8_t tiles_page = 0x08;	//c000 page 0x08
uint8_t Tile0_spr_page = 0x50; //Page used for tile data
uint8_t Tile_page = 0xc0;	//Video page used for layers

//The folloween arrays are set to be read by the "set_ports" function.
//"set_ports" writes the needed ports, to copy data using DMA
/*
Structure of the DMA arrays
PORTS   VALUES
-------------------------
0x1a,	Source Low
0x1b,	Source high
0x1c,	start page High
0x1d,	Destination Low
0x1e,	Destination High
0x1f,	start page
0x26,	Busrt length
0x28,	Burst number
0x27,	Start trasnfer
0xff	END
*/

uint8_t Copy_GFX[] = {
	0x1a,0,
	0x1b,0,
	0x1c,0,//GFX_Page,
	0x1d,0,
	0x1e,0,
	0x1f,0,//GFX_Video_Page,
	0x26,256/2-1,
	0x28,255,
	0x27,0,//DMA_RAM + DMA_SALGN,
	0xff
};

uint8_t Copy_Tiles[] = {
	0x1a,0,
	0x1b,0,
	0x1c,0,//tiles_page
	0x1d,0,
	0x1e,0,
	0x1f,0,//Tile0_spr_page
	0x26,256/2-1,
	0x28,255,
	0x27,0,//DMA_RAM + DMA_DALGN// + DMA_ASZ
	0xff
};

//Don't get this wrong, It is not copying pixel data to fake sprites
//It's just copying sprite properties (position, flips...) using dma.
//Sprites are not working as spected, I'm missing something
uint8_t Copy_Sprites[] = {
	0x1a,0,//_rocket_sprite & 0xFF	// Source low
	0x1b,0,//_rocket_sprite >> 8	// Source high
	0x1c,2,		// start page High?
	0x1d,0,		// Destination Low?
	0x1e,0,		// Destination High?
	0x1f,0,		// start page?
	0x26,5,		// Busrt length
	0x28,0,		// Burst number
	0x27,0,//DMA_RAM_SFILE	// Start
	0xff
};

uint8_t Init_Layers[] = {
	0x16,0,//Tile_page
	0x17,0,//Tile0_spr_page
	0x18,0,//Tile0_spr_page
	0x07,0,
	0xff
};


uint8_t Parallax = 0;
uint16_t SX0 = 0;
uint16_t SY0 = 0;
uint16_t SX1 = 0;
uint16_t SY1 = 0;
uint16_t SX2 = 0;
uint16_t SY2 = 0;

struct sprite {
    uint8_t y;
    uint8_t yflags;
    uint8_t x;
    uint8_t xflags;
	uint8_t tnumber;
	uint8_t npal;
};

struct sprite Sprite[5];

uint8_t rocket_sprite[6*16] = {
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

//#define kakb  0

const uint8_t Map_Layer2[] = {
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,140,141,142,143,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,146,147,148,149,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,140,141,142,143,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,150,151,152,153,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,146,147,148,149,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,154,155,156,157,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,15,20,17,18,23,24,25,26,27,28,29,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,9,10,1,1,168,161,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,30,31,32,33,34,39,40,41,42,43,44,45,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,11,12,13,14,1,1,160,163,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,46,47,48,49,50,55,56,57,58,59,60,61,1,1,1,1,1,1,1,1,1,1,1,1,1,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,62,63,64,65,66,71,72,73,74,75,76,77,1,1,1,1,1,1,1,1,1,1,1,1,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,124,125,126,127,124,125,126,127,1,1,1,1,1,1,1,1,1,1,1,1,1,1,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,128,129,130,131,128,129,130,131,1,1,1,1,1,1,1,1,1,1,1,1,1,1,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,132,133,134,135,132,133,134,135,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,78,79,80,73,73,81,80,73,73,81,82,83,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,136,137,138,139,136,137,138,139,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,84,85,86,87,88,89,86,87,88,89,90,91,1,1,1,1,
1,1,140,141,142,143,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,9,10,92,93,94,95,96,97,94,95,96,97,98,99,1,1,1,1,
1,1,146,147,148,149,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,11,12,13,14,100,101,102,103,104,105,102,103,104,105,106,107,1,1,1,1,
1,1,150,151,152,153,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,15,20,17,18,23,20,21,22,23,108,109,110,111,20,21,22,23,24,25,26,27,28,29,1,1,
1,1,154,155,156,157,1,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,30,31,32,33,34,39,36,37,38,39,112,113,114,115,36,37,38,39,40,41,42,43,44,45,1,1,
1,1,1,168,161,1,1,140,141,142,143,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,46,47,48,49,50,55,52,53,54,55,116,117,118,119,52,53,54,55,56,57,58,59,60,61,1,1,
1,1,1,160,163,1,1,146,147,148,149,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,62,63,64,65,66,71,68,69,70,71,120,121,122,123,68,69,70,71,72,73,74,75,76,77,1,1,
16,17,18,23,20,21,22,23,24,25,26,27,28,29,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,124,125,126,127,124,125,126,127,124,125,126,127,108,109,110,111,124,125,126,127,1,1,1,15,
32,33,34,39,36,37,38,39,40,41,42,43,44,45,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,128,129,130,131,128,129,130,131,128,129,130,131,112,113,114,115,128,129,130,131,1,1,1,31,
48,49,50,55,52,53,54,55,56,57,58,59,60,61,1,1,2,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,132,133,134,135,132,133,134,135,132,133,134,135,116,117,118,119,132,133,134,135,1,1,1,47,
64,65,66,71,68,69,70,71,72,73,74,75,76,77,1,1,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,136,137,138,139,136,137,138,139,136,137,138,139,120,121,122,123,136,137,138,139,1,1,1,63,
124,125,126,127,124,125,126,127,124,125,126,127,1,1,1,1,6,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
128,129,130,131,128,129,130,131,128,129,130,131,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
132,133,134,135,132,133,134,135,132,133,134,135,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
136,137,138,139,136,137,138,139,136,137,138,139,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,140,141,142,143,1,1,1,1,144,125,126,145,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,146,147,148,149,1,1,1,1,128,129,130,131,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,9,10,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,150,151,152,153,1,1,1,1,132,133,134,135,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,11,12,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,154,155,156,157,1,1,1,1,136,137,138,139,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,15,16,17,18,19,24,25,26,27,28,29,1,1,140,141,158,159,159,159,142,143,1,1,1,1,1,168,161,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,30,31,32,33,34,35,40,41,42,43,44,45,1,1,146,147,147,147,147,147,147,162,1,1,1,1,1,160,163,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,46,47,48,49,50,51,56,57,58,59,60,61,1,1,164,147,147,147,170,171,152,167,1,1,1,1,1,160,163,1,1,1,1,1,1,1,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,62,63,64,65,66,67,72,73,74,75,76,77,1,1,164,170,171,152,169,152,152,167,1,1,1,1,1,160,163,1,1,1,1,1,1,1,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,78,79,80,73,73,81,82,83,1,1,1,1,164,169,152,152,152,152,152,167,1,1,1,15,16,17,18,19,24,25,26,27,28,29,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,84,85,86,87,88,89,90,91,1,1,1,1,172,152,152,152,152,152,152,167,1,1,30,31,32,33,34,35,40,41,42,43,44,45,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,92,93,94,95,96,97,98,99,1,1,1,1,173,152,152,152,152,152,152,174,1,1,46,47,48,49,50,51,56,57,58,59,60,61,1,1,1,1,1,1,116,117,118,119,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,100,101,102,103,104,105,106,107,1,1,1,1,175,176,177,177,177,177,178,157,1,1,62,63,64,65,66,67,72,73,74,75,76,77,1,1,1,1,1,1,120,121,122,123,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,78,79,80,73,73,81,82,83,1,1,1,1,1,1,1,181,182,1,1,1,1,1,1,1,78,79,80,73,73,81,82,83,1,1,1,1,1,1,1,1,124,125,126,127,108,109,110,111,124,125,126,145,
1,1,1,1,1,1,1,1,1,1,1,1,84,85,86,87,88,89,90,91,1,1,1,1,1,1,1,179,180,1,1,1,1,1,1,1,84,85,86,87,88,89,90,91,1,1,1,1,1,1,1,1,128,129,130,131,112,113,114,115,128,129,130,131,
1,1,1,1,1,1,1,1,1,1,1,1,92,93,94,95,96,97,98,99,1,1,1,1,1,1,1,179,180,1,1,1,1,8,9,10,92,93,94,95,96,97,98,99,1,1,1,1,1,1,1,1,132,133,134,135,116,117,118,119,132,133,134,135,
1,1,1,1,1,1,1,1,1,1,1,1,100,101,102,103,104,105,106,107,1,1,1,1,1,1,1,179,180,1,1,1,11,12,13,14,100,101,102,103,104,105,106,107,1,1,1,1,1,1,1,1,136,137,138,139,120,121,122,123,136,137,138,139,
1,1,1,1,1,1,1,15,16,17,18,19,20,21,22,23,20,21,22,23,108,109,110,111,20,21,22,23,108,109,110,111,20,21,22,23,20,21,22,23,20,21,22,23,24,25,26,27,28,29,1,1,1,1,1,1,116,117,118,119,1,1,1,1,
1,1,1,1,1,1,30,31,32,33,34,35,36,37,38,39,36,37,38,39,112,113,114,115,36,37,38,39,112,113,114,115,36,37,38,39,36,37,38,39,36,37,38,39,40,41,42,43,44,45,1,1,1,1,1,1,120,121,122,123,1,1,1,1,
1,1,1,1,1,1,46,47,48,49,50,51,52,53,54,55,52,53,54,55,116,117,118,119,52,53,54,55,116,117,118,119,52,53,54,55,52,53,54,55,52,53,54,55,56,57,58,59,60,61,1,1,1,1,1,1,116,117,118,119,1,1,1,1,
1,1,1,1,1,1,62,63,64,65,66,67,68,69,70,71,68,69,70,71,120,121,122,123,68,69,70,71,120,121,122,123,68,69,70,71,68,69,70,71,68,69,70,71,72,73,74,75,76,77,1,1,1,1,1,1,120,121,122,123,1,1,1,1,
183,184,183,184,183,184,183,184,78,79,80,73,73,81,80,73,73,81,80,73,116,117,118,119,73,81,80,73,116,117,118,119,73,81,80,73,73,81,80,73,73,81,80,73,73,81,82,83,183,184,183,184,183,184,183,184,188,189,188,189,183,184,183,184,
185,186,185,186,185,186,185,186,84,85,86,87,88,89,86,87,88,89,86,87,120,121,122,123,88,89,86,87,120,121,122,123,88,89,86,87,88,89,86,87,88,89,86,87,88,89,90,91,185,186,185,186,185,186,185,186,185,186,185,186,185,186,185,186,
187,187,187,187,187,187,187,187,92,93,94,95,96,97,94,95,96,97,94,95,116,117,118,119,96,97,94,95,116,117,118,119,96,97,94,95,96,97,94,95,96,97,94,95,96,97,98,99,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,
187,187,187,187,187,187,187,187,100,101,102,103,104,105,102,103,104,105,102,103,120,121,122,123,104,105,102,103,120,121,122,123,104,105,102,103,104,105,102,103,104,105,102,103,104,105,106,107,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187

};

const uint8_t Map_Layer1[] = {
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,
190,191,190,190,192,193,194,195,190,190,190,190,190,190,190,190,190,191,190,190,192,193,194,195,190,190,190,190,190,190,190,190,190,191,190,190,192,193,194,195,190,190,190,190,190,190,190,190,190,191,190,190,192,193,194,195,190,190,190,190,190,190,190,190,
196,194,194,194,194,194,194,194,197,198,199,190,190,190,190,190,196,194,194,194,194,194,194,194,197,198,199,190,190,190,190,190,196,194,194,194,194,194,194,194,197,198,199,190,190,190,190,190,196,194,194,194,194,194,194,194,197,198,199,190,190,190,190,190,
200,201,202,203,204,205,206,207,208,209,210,211,212,190,190,213,200,201,202,203,204,205,206,207,208,209,210,211,212,190,190,213,200,201,202,203,204,205,206,207,208,209,210,211,212,190,190,213,200,201,202,203,204,205,206,207,208,209,210,211,212,190,190,213,
214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,
230,194,194,194,194,194,231,232,233,234,235,236,237,238,239,240,230,194,194,194,194,194,231,232,233,234,235,236,237,238,239,240,230,194,194,194,194,194,231,232,233,234,235,236,237,238,239,240,230,194,194,194,194,194,231,232,233,234,235,236,237,238,239,240,
194,194,194,194,194,194,194,194,241,242,243,244,244,245,246,247,194,194,194,194,194,194,194,194,241,242,243,244,244,245,246,247,194,194,194,194,194,194,194,194,241,242,243,244,244,245,246,247,194,194,194,194,194,194,194,194,241,242,243,244,244,245,246,247,
194,194,194,194,194,194,194,194,194,248,244,244,244,244,249,250,194,194,194,194,194,194,194,194,194,248,244,244,244,244,249,250,194,194,194,194,194,194,194,194,194,248,244,244,244,244,249,250,194,194,194,194,194,194,194,194,194,248,244,244,244,244,249,250,
194,194,194,194,194,194,194,194,194,251,252,244,253,254,194,194,194,194,194,194,194,194,194,194,194,251,252,244,253,254,194,194,194,194,194,194,194,194,194,194,194,251,252,244,253,254,194,194,194,194,194,194,194,194,194,194,194,251,252,244,253,254,194,194,
194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,
194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,
194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,
194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,
194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,
194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194

};

const uint8_t Map_Palette[] = {
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,1,
17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,17,17,17,17,
17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,17,17,17,17,
17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,17,17,17,17,
17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,17,17,17,17,
33,33,33,33,33,33,33,33,33,33,33,33,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
33,33,33,33,33,33,33,33,33,33,33,33,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
33,33,33,33,33,33,33,33,33,33,33,33,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
33,33,33,33,33,33,33,33,33,33,33,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,33,33,33,33,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,33,33,33,33,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,33,33,33,33,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,1,1,1,1,33,33,33,33,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,1,1,1,1,1,1,1,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,33,33,33,33,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,
1,1,1,1,1,1,1,1,1,1,1,1,17,17,17,17,17,17,17,17,1,1,1,1,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,1,1,1,1,1,1,1,1,33,33,33,33,33,33,33,33,33,33,33,33,
1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,33,33,33,33,1,1,1,1,
1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,33,33,33,33,1,1,1,1,
1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,33,33,33,33,1,1,1,1,
1,1,1,1,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,1,1,1,1,1,33,33,33,33,1,1,1,1,
33,33,33,33,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,
33,33,33,33,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,
33,33,33,33,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,
33,33,33,33,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,17,17,17,17,33,33,33,33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33

};

/*
SFILE	Reg.16	7		6		5		4	        3  2  1		0
0		R0L		Y[7:0]							
1		R0H		YF		LEAP	ACT		reserved	YS[2:0]		Y[8]
2		R1L		X[7:0]							
3		R1H		XF		-		-		reserved	XS[2:0]		X[8]
4		R2L		TNUM[7:0] (X pos in vram)							
5		R2H		SPAL[7:4]							TNUM[11:8] (Y pos in vram)			

1 %00101010
3 %00000110
5 %00010111

X X coordinate, byte + 1 bit (address can be in the range of 0-511)
Y Y coordinate, byte + 1 bit
XS X size. (0 = 8, 1 = 16, ... 7 = 64 pixels)
YS Y size. (0 = 8, 1 = 16, ... 7 = 64 lines)
XF Flip the sprite horizontally in output. <em> Note that we need to draw 2 times less sprites! </em>
YF Flip the sprite vertically on output
ACT Display sprite (on / off)
LEAP Bit that determines the transition to the next layer for subsequent sprites. The third transition marks the end of the sprite handles
TNUM Number of the first tile in a sprite of the specified size. Bits 0-5 = X position in sprite graphics page, bits 6-11 = Y position.
SPAL Select a palette. 4 bits - 16 palettes available.
*/

//Initialize TSU (Sprite and Tile acelerator)
void Init_TSConf(){
#asm
	LD  BC,(_VPAGE)		
    LD  A,(_GFX_Video_Page)		// Tell the GPU to show a page from vram
    OUT (C),A
    LD  BC,(_VCONFIG)			
    LD  A,0x01+0xC0				// Set video to: 360x288 and 256 colors
    OUT (C),A
	LD  BC,(_TSCONFIG)		
	LD	A,/*0x04+0x08*/+0x20+0x40+0x80// TSU_T0EN | TSU_T1EN | TSU_SEN // Turn on tile layer 0-1 and sprites
	OUT (C),A
    EI                
    LD  HL,0x0000				// Set the initial offset to 0 pix
#endasm	
}

void Fill_Screen(){
#asm	
	LD  BC,(_PAGE3)		// Change to ram bank page 3 + "Vid_page" (GFX Layer)
	LD  A,(_GFX_Video_Page)+4		
	OUT (C),A			// Now Ram bank 3 + Vid_page is mapped to 0xC000
	LD  A,0x02
	LD	(0xC001),A		// pixel 1 = 3
	LD  HL,0xC000		// destination
	LD  DE,0xC001		// Source
    LD  BC,0x3fff		// Number of bytes/pixels to copy
	LDIR				// LD (HL),(DE); INC HL; INC DE; until BC = 0
#endasm	
	//memset(0xc000,0x03,256*32);
	//memcpy(0xC000+512*32,0xC000,512*32);

}

void Fill_Screen_DMA(){
#asm
	ld bc,(_PAGE3)
	ld a,(_GFX_Video_Page)
	out (c),a
	ld hl,0		//00 - цвет, заданный в палитре
	ld (0xc000),hl
	//ld hl,fill_screen
	jp set_ports
#endasm
}

//SCROLL LAYERS
///////////////

//Scrolls Layer 0 (graphics layer)
void GFX_SCRX(uint16_t x){
#asm 
	//ld iy,0x04
    //add iy,sp //Bypass the return address of the function 

    //ld l,(iy)   //x
    //ld a,1+(iy)  //y
	
    LD  BC,(_GXOFFSL)	// Set the least significant byte
    OUT (C),L         
    LD  BC,(_GXOFFSH)	// Set high byte
    OUT (C),H        
#endasm
}
void GFX_SCRY(uint16_t y){
#asm 
	//ld iy,0x04
    //add iy,sp //Bypass the return address of the function 

    //ld l,(iy)   //x
    //ld a,1+(iy)  //y
	
    LD  BC,(_GYOFFSL)    // Set the least significant byte
    OUT (C),L         
    LD  BC,(_GYOFFSH)    // Set high byte
    OUT (C),H        
#endasm
}

//Scrolls Layer 1 (Map-Tile Layer 0)
void T0_SCRX(uint16_t x){
#asm
	LD  BC,(_T0XOFFSL)    // Set the least significant byte
    OUT (C),L         
    LD  BC,(_T0XOFFSH)     // Set high byte
    OUT (C),H 
#endasm
}
void T0_SCRY(uint16_t y){
#asm
	LD  BC,(_T0YOFFSL)     // Set the least significant byte
    OUT (C),L         
    LD  BC,(_T0YOFFSH)     // Set high byte
    OUT (C),H 
#endasm
}

//Scrolls Layer 2 (Map-Tile Layer 1)
void T1_SCRX(uint16_t x){
#asm
	LD  BC,(_T1XOFFSL)     // Set the least significant byte
    OUT (C),L         
    LD  BC,(_T1XOFFSH)     // Set high byte
    OUT (C),H 
#endasm
}
void T1_SCRY(uint16_t y){
#asm
	LD  BC,(_T1YOFFSL)     // Set the least significant byte
    OUT (C),L         
    LD  BC,(_T1YOFFSH)     // Set high byte
    OUT (C),H 
#endasm
}

//A basic VSYNC, adding interrupts destroys it
void TS_VSync(){
#asm
	HALT
#endasm
}

void Load_Palette(){
#asm
	LD  A,%00010000		//Turn on mapping at #0000
    LD  BC,(_FMADDR)
    OUT (C),A
    LD  HL,0xD000		//Source
    LD  DE,0x0000		//Destination
    LD  BC,0x0200		//Counter (256*2)
    LDIR
    XOR  A				//Disable mapping
    LD  BC,(_FMADDR)
    OUT (C),A
	
	//Palette selection for 4 bit modes;
	/*
	PAL_GPAL_MASK   = 0x0F;
	PAL_GPAL_BS     = 0;
	PAL_T0PAL_MASK  = 0x30;
	PAL_T0PAL_BS    = 4;
	PAL_T1PAL_MASK  = 0xC0;
	PAL_T1PAL_BS    = 6;
	*/
	LD  A,%00000000  //
	LD  BC,(_PALSEL)    // GFX T0 T1 use palettes 0-4
	OUT (C),A
#endasm
}

//Load image to Layer 0, This layer is pixel based (not tiles)
void Load_GFX_Image(){
	Copy_GFX[5] = GFX_Page; 			//Address of image in spg
	Copy_GFX[11] = GFX_Video_Page;		//Video page set in Init_TSConf
	Copy_GFX[17] = DMA_RAM + DMA_SALGN;	//Alignment
#asm
	ld hl,_Copy_GFX
	call set_ports
#endasm
}

/*ld bc,T0GPAGE
 	ld a,0x08
 	out (c),a
 	ld bc,PAGE3
 	out (c),a
 	ld hl,0x0000
	ld de,0x00ff
	ld bc,16384
	ld (hl),l
	ldir*/

//Load tiles to tiles page, so that layers 1 and 2 can use them.
//Using DMA
void Load_Tiles_DMA(){
	Copy_Tiles[5] = tiles_page;				//Address of image in spg
	Copy_Tiles[11] = Tile0_spr_page;        //Video page set fot tile storage
	Copy_Tiles[17] = DMA_RAM + DMA_SALGN;   //Alignment
#asm
	ld hl,_Copy_Tiles
	call set_ports
#endasm
}

void Init_TileLayers(){
	Init_Layers[1] = Tile_page;			
	Init_Layers[3] = Tile0_spr_page;
	Init_Layers[5] = Tile0_spr_page;
#asm
	ld hl,_Init_Layers
    call set_ports
#endasm
}

void Load_MAP(uint16_t map, uint16_t plane){
#asm
	//Fill map
	//ld hl,0xc080
	dec hl
	dec hl
	ld de,_Map_Layer2
	add de,64*27
	ld bc,0x2020
	inc hl
	inc hl
	
	ld a,(_Tile_page)
	exx					// Store bc de and hl in shadow regs
	ld bc,(_PAGE3)			// Turn on the tile map page
	out (c),a			// Now map address is mapped to 0xC000
	exx					// Restore bc de and hl from shadow regs

	ld c,64				//Map size X
	ld b,36				//Map size Y
	
.r2fil
	LD	a,(de)
	dec	a
	ld (hl),a		// load the tile number
	add hl,2
	inc de			// goto next position in map
	
	dec c
	jr nz,r2fil
	
	ld c,64			
	add hl,128		// goto Next Map line in Vram (remember map0 and map1 are interleaved)
	
	//ld de,_map
	dec b
	jr nz,r2fil
	
#endasm
}

void Load_MAP1(uint16_t map, uint16_t plane){
#asm
	//Fill map
	//ld hl,0xc000
	dec hl
	dec hl
	ld de,_Map_Layer1
	add de,64*27
	ld bc,0x2020
	inc hl
	inc hl
	
	ld a,(_Tile_page)
	exx					// Store bc de and hl in shadow regs
	ld bc,(_PAGE3)		// Turn on the tile map page
	out (c),a			// Now map address is mapped to 0xC000
	exx					// Restore bc de and hl from shadow regs

	ld c,64				//Map size X
	ld b,36				//Map size Y
.r3fil
	LD	a,(de)
	dec	a
	ld (hl),a		// load the tile number
	add hl,2
	inc de			// goto next position in map
	
	dec c
	jr nz,r3fil
	
	ld c,64			
	add hl,128		// goto Next Map line in Vram (remember map0 and map1 are interleaved)
	
	//ld de,_map
	dec b
	jr nz,r3fil
	
#endasm
}

void Load_MAP_Prop(uint16_t plane){
#asm
	//Fill map
	//ld hl,0xc081
	ld de,_Map_Palette+(64*27)
	ld bc,0x2020
	
	ld a,(_Tile_page)
	exx					// Store bc de and hl in shadow regs
	ld bc,(_PAGE3)			// Turn on the tile map page
	out (c),a			// Now map address is mapped to 0xC000
	exx					// Restore bc de and hl from shadow regs

	ld c,64				//Map size X
	ld b,36				//Map size Y
	
.r2filp
	LD	a,(de)
	dec a
	ld (hl),a			// load the tile properties
	add hl,2
	inc de				// goto next position in map 

	dec c
	jr nz,r2filp
	ld c,64			
	add hl,128			// goto Next Map line in Vram (remember map0 and map1 are interleaved)
	dec b
	jr nz,r2filp
	
#endasm
}

void Load_MAP1_Prop(uint16_t plane){
#asm
	//Fill map
	//ld hl,0xc081
	//ld de,_map2+(64*27)
	ld bc,0x2020
	
	ld a,(_Tile_page)
	exx					// Store bc de and hl in shadow regs
	ld bc,(_PAGE3)			// Turn on the tile map page
	out (c),a			// Now map address is mapped to 0xC000
	exx					// Restore bc de and hl from shadow regs

	ld c,64				//Map size X
	ld b,36				//Map size Y
	
.r4filp
	//LD	a,(de)
	//dec a
	ld (hl),0x00		// load the tile properties
	add hl,2
	//inc de				// goto next position in map 

	dec c
	jr nz,r4filp
	ld c,64			
	add hl,128			// goto Next Map line in Vram (remember map0 and map1 are interleaved)
	dec b
	jr nz,r4filp
	
#endasm
}

//Set video page used for sprite images
void Set_Sprites_Page(){
#asm
	ld bc,(_SGPAGE)
	ld a,(_Tile0_spr_page)
	out (c),a
#endasm
}

//Upload data to sprite ram (Positions, flips, paletes, offset and sizes)
//Not working well
void Update_Sprite_Descriptors_DMA(uint8_t number){
	Copy_Sprites[1] = Sprite[0] & 0xFF;
	Copy_Sprites[3] = Sprite[0] >> 8;
	Copy_Sprites[17] = DMA_RAM_SFILE;

#asm
	LD  A,%00010000		//Turn on mapping at #0000
    LD  BC,(_FMADDR)
    OUT (C),A

	//Upload new values to sprite memory
	ld hl,_Copy_Sprites
	call set_ports
	
	XOR  A				//Disable mapping
    LD  BC,(_FMADDR)
    OUT (C),A
#endasm	
}

//Upload data to sprite ram (Positions, flips, paletes, offset and sizes)
void Update_Sprite_Descriptors(){
#asm
	LD  A,%00010000		//Turn on mapping at #0000
    LD  BC,(_FMADDR)
    OUT (C),A
	
	LD  HL,_Sprite	//Source
    LD  DE,0x0200			//Destination
    LD  BC,0x0030			//Counter (6*8)
    LDIR

	XOR  A				//Disable mapping
    LD  BC,(_FMADDR)
    OUT (C),A
#endasm
}


//Did not work
void Install_LineInterrupt(){
#asm
	ld	hl,line_proc
	ld	(0xbefd),hl

	ld	bc,(_INTMASK)
	ld	a,%00000010
	out	(c),a
#endasm
}

void Line_Program(){
#asm
.line_proc	
	di
	LD  BC,(_GXOFFSL)	// Set the least significant byte
    OUT (C),0
	ei
	ret
#endasm
}


void Set_Ports(){
#asm
.set_ports
	ld c,0xaf
	ld c,0xaf
	ld a,(hl)
	cp 0xff
	jr z,dma_stats
	ld b,a
	inc hl
	ld a,(hl)
	inc hl
	out (c),a
	jr set_ports+2
	ret

.dma_stats	
	ld bc,0x27af
	in a,(c)
	AND 0x80
	jr nz,$-4
	ret
	
#endasm
}

int main(){
	
	int rocket_X = 0;
	
	Init_TSConf();
	
	Load_Palette();
	
	Load_GFX_Image();
	
	Init_TileLayers();
	Load_Tiles_DMA();
	
	Load_MAP1(Map_Layer2,0xC000);
	Load_MAP1_Prop(0xc001);
	Load_MAP(Map_Layer1,0xC080);
	Load_MAP_Prop(0xC081);
	
	//Fill_Screen();
	Set_Sprites_Page();
	
	//Robot1
	Sprite[0].x = 64; Sprite[0].y = 64; 
	Sprite[0].yflags = SP_SIZE32 | SP_LEAP | SP_ACT;
	Sprite[0].xflags = SP_SIZE32;
	Sprite[0].tnumber = 4; Sprite[0].npal = (3<<4) | 3;
	
	//Robot2
	Sprite[1].x = 255; Sprite[1].y = 32;
	Sprite[1].yflags = SP_SIZE32 | SP_LEAP | SP_ACT;
	Sprite[1].xflags = SP_SIZE32;
	Sprite[1].tnumber = 0; Sprite[1].npal = (3<<4) | 5;
	
	//Rocket
	Sprite[2].x = 0; Sprite[2].y = 128;
	Sprite[2].yflags = SP_SIZE64 | 0 | SP_ACT;
	Sprite[2].xflags = SP_SIZE64;
	Sprite[2].tnumber = 0; Sprite[2].npal = (3<<4) | 1;
	
	Sprite[3].x = 64; Sprite[3].y = 128;
	Sprite[3].yflags = SP_SIZE64 | 0 | SP_ACT;
	Sprite[3].xflags = SP_SIZE64;
	Sprite[3].tnumber = 8; Sprite[3].npal = (3<<4) | 1;
	
	Sprite[4].x = 128; Sprite[4].y = 128;
	Sprite[4].yflags = SP_SIZE64 | 0 | SP_ACT;
	Sprite[4].xflags = SP_SIZE64;
	Sprite[4].tnumber = 16; Sprite[4].npal = (3<<4) | 1;
	
	Sprite[5].x = 0; Sprite[5].y = 192;
	Sprite[5].yflags = SP_SIZE64 | 0 | SP_ACT;
	Sprite[5].xflags = SP_SIZE64;
	Sprite[5].tnumber = 24; Sprite[5].npal = (3<<4) | 1;
	
	Sprite[6].x = 64; Sprite[6].y = 192;
	Sprite[6].yflags = SP_SIZE64 | 0 | SP_ACT;
	Sprite[6].xflags = SP_SIZE64;
	Sprite[6].tnumber = 32; Sprite[6].npal = (3<<4) | 1;
	
	Sprite[7].x = 128; Sprite[7].y = 192;
	Sprite[7].yflags = SP_SIZE64 | 0 | SP_ACT;
	Sprite[7].xflags = SP_SIZE64;
	Sprite[7].tnumber = 40; Sprite[7].npal = (3<<4) | 1;
	
	
	//Install_LineInterrupt();
	while(1){

		GFX_SCRX(SX0); //GFX_SCRY(SY);
		T0_SCRX(SX1); //T0_SCRY(32);
		T1_SCRX(SX2);

		Sprite[0].x ++;
		
		Sprite[2].x = rocket_X;
		Sprite[3].x = rocket_X+64;
		Sprite[4].x = rocket_X+128;
		Sprite[5].x = rocket_X;
		Sprite[6].x = rocket_X+64;
		Sprite[7].x = rocket_X+128;
		
		
		Parallax++;
		if (Parallax == 2){Parallax = 0;SX0++;Sprite[0].tnumber+=4; rocket_X++;}
		if (Sprite[0].tnumber == 12*4) Sprite[0].tnumber = 0;
		SX1++;
		SX2+=2;
		
		Update_Sprite_Descriptors();
		TS_VSync();
	}
	return 0;
}


